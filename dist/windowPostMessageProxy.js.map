{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap a28a9a65f634bb9e068a","webpack:///./src/windowPostMessageProxy.ts"],"names":[],"mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;ACVA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;;ACgBA;KA+DE,gCACE,OASC;SATD;aACE,yBAAyB,EAAE;iBACzB,qBAAqB,EAAE,sBAAsB,CAAC,4BAA4B;iBAC1E,qBAAqB,EAAE,sBAAsB,CAAC,4BAA4B;cAC3E;aACD,cAAc,EAAE,sBAAsB,CAAC,qBAAqB;aAC5D,mBAAmB,EAAE,sBAAsB,CAAC,0BAA0B;aACtE,aAAa,EAAE,MAAM;aACrB,IAAI,EAAE,sBAAsB,CAAC,kBAAkB,EAAE;UAClD;SAVH,iBAgCC;SAtCO,2BAAsB,GAAmB,EAAE,CAAC;SAkBlD,6BAA6B;SAC7B,IAAI,CAAC,qBAAqB,GAAG,CAAC,OAAO,CAAC,yBAAyB,IAAI,OAAO,CAAC,yBAAyB,CAAC,qBAAqB,CAAC,IAAI,sBAAsB,CAAC,4BAA4B,CAAC;SACnL,IAAI,CAAC,qBAAqB,GAAG,CAAC,OAAO,CAAC,yBAAyB,IAAI,OAAO,CAAC,yBAAyB,CAAC,qBAAqB,CAAC,IAAI,sBAAsB,CAAC,4BAA4B,CAAC;SACnL,IAAI,CAAC,cAAc,GAAG,OAAO,CAAC,cAAc,IAAI,sBAAsB,CAAC,qBAAqB,CAAC;SAC7F,IAAI,CAAC,mBAAmB,GAAG,OAAO,CAAC,mBAAmB,IAAI,sBAAsB,CAAC,0BAA0B,CAAC;SAC5G,IAAI,CAAC,aAAa,GAAG,OAAO,CAAC,aAAa,IAAI,MAAM,CAAC;SACrD,IAAI,CAAC,IAAI,GAAG,OAAO,CAAC,IAAI,IAAI,sBAAsB,CAAC,kBAAkB,EAAE,CAAC;SACxE,IAAI,CAAC,MAAM,GAAG,OAAO,CAAC,MAAM,CAAC;SAC7B,IAAI,CAAC,WAAW,GAAG,OAAO,CAAC,WAAW,IAAI,KAAK,CAAC;SAChD,IAAI,CAAC,yBAAyB,GAAG,OAAO,CAAC,yBAAyB,CAAC;SACnE,IAAI,CAAC,gBAAgB,GAAG,OAAO,CAAC,gBAAgB,IAAI,KAAK,CAAC;SAE1D,IAAI,IAAI,CAAC,WAAW,EAAE;aACpB,OAAO,CAAC,GAAG,CAAC,mDAAiD,IAAI,CAAC,IAAI,8BAAyB,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,KAAO,CAAC,CAAC;UACrI;SAED,aAAa;SACb,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;SACnB,IAAI,CAAC,oBAAoB,GAAG,UAAC,KAAmB,IAAK,YAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC,EAA7B,CAA6B,CAAC;SACnF,IAAI,CAAC,KAAK,EAAE,CAAC;KACf,CAAC;KA9FD,SAAS;KACF,mDAA4B,GAAnC,UAAuC,OAAU,EAAE,kBAAuC;SAClF,OAAQ,CAAC,sBAAsB,CAAC,mBAAmB,CAAC,GAAG,kBAAkB,CAAC;SAChF,OAAO,OAAO,CAAC;KACjB,CAAC;KACM,mDAA4B,GAAnC,UAAoC,OAAY;SAC9C,OAAO,OAAO,CAAC,sBAAsB,CAAC,mBAAmB,CAAC,CAAC;KAC7D,CAAC;KAEM,4CAAqB,GAA5B,UAA6B,OAAY;SACvC,OAAO,CAAC,CAAC,OAAO,CAAC,KAAK,CAAC;KACzB,CAAC;KAEM,iDAA0B,GAAjC,UAAkC,OAAY;SAC5C,OAAO,OAAO,CAAC,KAAK,CAAC;KACvB,CAAC;KAGD;;QAEG;KACH,iEAAiE;KACjE,oIAAoI;KACrH,qCAAc,GAA7B;SACE,IAAM,QAAQ,GAAc;aAC1B,OAAO,EAAE,IAAI;aACb,MAAM,EAAE,IAAI;aACZ,OAAO,EAAE,IAAI;UACd,CAAC;SAEF,IAAM,OAAO,GAAG,IAAI,OAAO,CAAC,UAAC,OAAmB,EAAE,MAAkB;aAClE,QAAQ,CAAC,OAAO,GAAG,OAAO,CAAC;aAC3B,QAAQ,CAAC,MAAM,GAAG,MAAM,CAAC;SAC3B,CAAC,CAAC,CAAC;SAEH,QAAQ,CAAC,OAAO,GAAG,OAAO,CAAC;SAE3B,OAAO,QAAQ,CAAC;KAClB,CAAC;KAED;;QAEG;KACY,yCAAkB,GAAjC;SACE,OAAO,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;KACvD,CAAC;KAmDD;;;QAGG;KACH,2CAAU,GAAV,UAAW,OAAwB;SACjC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;KAC9B,CAAC;KACD;;;QAGG;KACH,8CAAa,GAAb,UAAc,OAAwB;SACpC,IAAM,YAAY,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;SACpD,IAAI,YAAY,KAAK,CAAC,CAAC,EAAE;aACvB,MAAM,IAAI,KAAK,CAAC,sEAAsE,CAAC,CAAC;UACzF;SAED,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,YAAY,EAAE,CAAC,CAAC,CAAC;KACxC,CAAC;KAED;;QAEG;KACH,sCAAK,GAAL;SACE,IAAI,CAAC,aAAa,CAAC,gBAAgB,CAAC,SAAS,EAAE,IAAI,CAAC,oBAAoB,CAAC,CAAC;KAC5E,CAAC;KAED;;QAEG;KACH,qCAAI,GAAJ;SACE,IAAI,CAAC,aAAa,CAAC,mBAAmB,CAAC,SAAS,EAAE,IAAI,CAAC,oBAAoB,CAAC,CAAC;KAC/E,CAAC;KAED;;QAEG;KACH,4CAAW,GAAX,UAAe,YAAoB,EAAE,OAAY;SAC/C,mEAAmE;SACnE,IAAM,kBAAkB,GAAwB;aAC9C,EAAE,EAAE,sBAAsB,CAAC,kBAAkB,EAAE;aAC/C,MAAM,EAAE,IAAI,CAAC,IAAI;aACjB,MAAM,EAAE,IAAI,CAAC,MAAM;UACpB,CAAC;SACF,IAAI,CAAC,qBAAqB,CAAC,OAAO,EAAE,kBAAkB,CAAC,CAAC;SAExD,IAAI,IAAI,CAAC,WAAW,EAAE;aACpB,OAAO,CAAC,IAAI,CAAC,WAAS,IAAI,CAAC,IAAI,gBAAa,EAAE,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC;UACpF;SAED,YAAY,CAAC,WAAW,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC;SACvC,IAAM,QAAQ,GAAG,sBAAsB,CAAC,cAAc,EAAE,CAAC;SACzD,IAAI,CAAC,sBAAsB,CAAC,kBAAkB,CAAC,EAAE,CAAC,GAAG,QAAQ,CAAC;SAE9D,OAAO,QAAQ,CAAC,OAAO,CAAC;KAC1B,CAAC;KAED;;;QAGG;KACK,6CAAY,GAApB,UAAqB,YAAoB,EAAE,OAAY,EAAE,kBAAuC;SAC9F,IAAI,CAAC,qBAAqB,CAAC,OAAO,EAAE,kBAAkB,CAAC,CAAC;SAExD,IAAI,IAAI,CAAC,WAAW,EAAE;aACpB,OAAO,CAAC,IAAI,CAAC,WAAS,IAAI,CAAC,IAAI,mBAAgB,EAAE,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC;UACvF;SAED,YAAY,CAAC,WAAW,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC;KACzC,CAAC;KAED;;QAEG;KACK,kDAAiB,GAAzB,UAA0B,KAAmB;SAA7C,iBAuHC;SAtHC,IAAI,aAAa,GAAG,IAAI,CAAC,yBAAyB,IAAI,KAAK,CAAC,MAAM,CAAC;SACnE,IAAI,OAAO,GAAQ,KAAK,CAAC,IAAI,CAAC;SAE9B,IAAI,OAAO,OAAO,KAAK,QAAQ,EAAE;aAC/B,IAAI,CAAC,IAAI,CAAC,gBAAgB,EAAE;iBAC1B,OAAO,CAAC,IAAI,CAAC,WAAS,IAAI,CAAC,IAAI,mEAAgE,CAAC,CAAC;cAClG;aACD,OAAO;UACR;SAED,IAAI,kBAAuC,CAAC;SAC5C,IAAI;aACF,kBAAkB,GAAG,IAAI,CAAC,qBAAqB,CAAC,OAAO,CAAC,CAAC;aAEzD,IAAI,kBAAkB,IAAI,kBAAkB,CAAC,MAAM,IAAI,IAAI,EAAE;iBAC3D,IAAI,kBAAkB,CAAC,MAAM,KAAK,IAAI,CAAC,IAAI,EAAE;qBAC3C,sCAAsC;qBACtC,OAAO;kBACR;cACF;aAED,IAAI,IAAI,CAAC,WAAW,EAAE;iBACpB,OAAO,CAAC,IAAI,CAAC,WAAS,IAAI,CAAC,IAAI,kBAAe,EAAE,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC;cACzF;UACF;SACD,OAAO,CAAC,EAAE;aACR,IAAI,CAAC,IAAI,CAAC,gBAAgB,EAAE;iBAC1B,OAAO,CAAC,IAAI,CAAC,WAAS,IAAI,CAAC,IAAI,wFAAqF,EAAE,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE,IAAI,EAAE,IAAI,CAAC,EAAE,SAAS,EAAE,CAAC,CAAC,CAAC;cAC1K;UACF;SAED,IAAI,QAAmB,CAAC;SACxB,IAAI,kBAAkB,EAAE;aACtB,QAAQ,GAAG,IAAI,CAAC,sBAAsB,CAAC,kBAAkB,CAAC,EAAE,CAAC,CAAC;UAC/D;SAED,6DAA6D;SAC7D,uCAAuC;SACvC,IAAI,CAAC,QAAQ,EAAE;aACb,IAAM,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,iBAAO;iBACxC,IAAI,mBAAmB,GAAG,KAAK,CAAC;iBAChC,IAAI;qBACF,mBAAmB,GAAG,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;kBAC7C;iBACD,OAAO,CAAC,EAAE;qBACR,IAAI,CAAC,KAAI,CAAC,gBAAgB,EAAE;yBAC1B,OAAO,CAAC,IAAI,CAAC,WAAS,KAAI,CAAC,IAAI,iEAA8D,EAAE,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE,IAAI,EAAE,IAAI,CAAC,EAAE,SAAS,EAAE,CAAC,CAAC,CAAC;sBACnJ;kBACF;iBAED,IAAI,mBAAmB,EAAE;qBACvB,IAAI,sBAAsB,SAAc,CAAC;qBAEzC,IAAI;yBACF,sBAAsB,GAAG,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,CAAC;sBACnE;qBACD,OAAO,CAAC,EAAE;yBACR,IAAI,CAAC,KAAI,CAAC,gBAAgB,EAAE;6BAC1B,OAAO,CAAC,IAAI,CAAC,WAAS,KAAI,CAAC,IAAI,oEAAiE,EAAE,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE,IAAI,EAAE,IAAI,CAAC,EAAE,SAAS,EAAE,CAAC,CAAC,CAAC;0BACtJ;yBACD,sBAAsB,GAAG,OAAO,CAAC,OAAO,EAAE,CAAC;sBAC5C;qBAED,sBAAsB;0BACnB,IAAI,CAAC,yBAAe;yBACnB,IAAI,CAAC,eAAe,EAAE;6BACpB,IAAM,cAAc,GAAG,0BAAwB,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE,IAAI,EAAE,IAAI,CAAC,+FAA4F,CAAC;6BAC/K,IAAI,CAAC,KAAI,CAAC,gBAAgB,EAAE;iCAC1B,OAAO,CAAC,IAAI,CAAC,WAAS,KAAI,CAAC,IAAI,WAAM,cAAgB,CAAC,CAAC;8BACxD;6BACD,eAAe,GAAG;iCAChB,OAAO,EAAE,cAAc;8BACxB,CAAC;0BACH;yBAED,kBAAkB,CAAC,MAAM,GAAG,kBAAkB,CAAC,MAAM,CAAC;yBACtD,kBAAkB,CAAC,MAAM,GAAG,KAAI,CAAC,IAAI,CAAC;yBACtC,KAAI,CAAC,YAAY,CAAC,aAAuB,EAAE,eAAe,EAAE,kBAAkB,CAAC,CAAC;qBAClF,CAAC,CAAC,CAAC;qBAEL,OAAO,IAAI,CAAC;kBACb;aACH,CAAC,CAAC,CAAC;aAEH;;;;;gBAKG;aACH,IAAI,CAAC,OAAO,IAAI,CAAC,IAAI,CAAC,gBAAgB,EAAE;iBACtC,OAAO,CAAC,IAAI,CAAC,WAAS,IAAI,CAAC,IAAI,4CAAuC,IAAI,CAAC,QAAQ,CAAC,MAAM,mBAAc,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE,IAAI,EAAE,EAAE,CAAC,MAAG,CAAC,CAAC;iBAC9I,+DAA+D;cAChE;UACF;cACI;aACH;;;gBAGG;aACH,IAAI,cAAc,GAAG,IAAI,CAAC;aAC1B,IAAI;iBACF,cAAc,GAAG,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC;cAC/C;aACD,OAAO,CAAC,EAAE;iBACR,OAAO,CAAC,IAAI,CAAC,WAAS,IAAI,CAAC,IAAI,kGAA+F,EAAE,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE,IAAI,EAAE,EAAE,CAAC,EAAE,SAAS,EAAE,CAAC,CAAC,CAAC;cAClL;aAED,IAAI,cAAc,EAAE;iBAClB,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,mBAAmB,CAAC,OAAO,CAAC,CAAC,CAAC;cACpD;kBACI;iBACH,QAAQ,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;cAC3B;aAED,4GAA4G;aAC5G,OAAO,IAAI,CAAC,sBAAsB,CAAC,kBAAkB,CAAC,EAAE,CAAC,CAAC;UAC3D;KACH,CAAC;KAhRc,0CAAmB,GAAG,wBAAwB,CAAC;KAiRhE,6BAAC;EAAA;AAnSY,yDAAsB","file":"windowPostMessageProxy.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"window-post-message-proxy\"] = factory();\n\telse\n\t\troot[\"window-post-message-proxy\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap a28a9a65f634bb9e068a","interface IDeferred {\n  resolve: <T>(value?: T | Promise<T>) => void;\n  reject: <T>(error: T) => void;\n  promise: Promise<any>;\n}\n\ninterface IDeferredCache {\n  [messageId: string]: IDeferred;\n}\n\nexport interface ITrackingProperties {\n  id: string;\n  source: string;\n  target?: string;\n}\n\nexport interface IAddTrackingProperties {\n  <T>(message: T, trackingProperties: ITrackingProperties): T;\n}\n\nexport interface IGetTrackingProperties {\n  (message: any): ITrackingProperties;\n}\n\nexport interface IProcessTrackingProperties {\n  addTrackingProperties: IAddTrackingProperties;\n  getTrackingProperties: IGetTrackingProperties;\n}\n\nexport interface IIsErrorMessage {\n  (message: any): boolean;\n}\n\nexport interface IExtractErrorMessage {\n  (message: any): any;\n}\n\nexport interface IMessageHandler {\n  test(message: any): boolean;\n  handle(message: any): any;\n}\n\nexport interface IWindowPostMessageProxyOptions {\n  receiveWindow?: Window;\n  processTrackingProperties?: IProcessTrackingProperties;\n  isErrorMessage?: IIsErrorMessage;\n  extractErrorMessage?: IExtractErrorMessage;\n  name?: string;\n  target?: string;\n  logMessages?: boolean;\n  eventSourceOverrideWindow?: Window;\n  suppressWarnings?: boolean;\n}\n\nexport class WindowPostMessageProxy {\n  // Static\n  static defaultAddTrackingProperties<T>(message: T, trackingProperties: ITrackingProperties): T {\n    (<any>message)[WindowPostMessageProxy.messagePropertyName] = trackingProperties;\n    return message;\n  }\n  static defaultGetTrackingProperties(message: any): ITrackingProperties {\n    return message[WindowPostMessageProxy.messagePropertyName];\n  }\n\n  static defaultIsErrorMessage(message: any): boolean {\n    return !!message.error;\n  }\n\n  static defaultExtractErrorMessage(message: any): any {\n    return message.error;\n  }\n\n  private static messagePropertyName = \"windowPostMessageProxy\";\n  /**\n   * Utility to create a deferred object.\n   */\n  // TODO: Look to use RSVP library instead of doing this manually.\n  // From what I searched RSVP would work better because it has .finally and .deferred; however, it doesn't have Typings information. \n  private static createDeferred(): IDeferred {\n    const deferred: IDeferred = {\n      resolve: null,\n      reject: null,\n      promise: null\n    };\n\n    const promise = new Promise((resolve: () => void, reject: () => void) => {\n      deferred.resolve = resolve;\n      deferred.reject = reject;\n    });\n\n    deferred.promise = promise;\n\n    return deferred;\n  }\n\n  /**\n   * Utility to generate random sequence of characters used as tracking id for promises.\n   */\n  private static createRandomString(): string {\n    return (Math.random() + 1).toString(36).substring(7);\n  }\n\n  // Private\n  private logMessages: boolean;\n  private name: string;\n  private target?: string;\n  private addTrackingProperties: IAddTrackingProperties;\n  private getTrackingProperties: IGetTrackingProperties;\n  private isErrorMessage: IIsErrorMessage;\n  private extractErrorMessage: IExtractErrorMessage;\n  private receiveWindow: Window;\n  private pendingRequestPromises: IDeferredCache = {};\n  private handlers: IMessageHandler[];\n  private windowMessageHandler: (e: MessageEvent) => any;\n  private eventSourceOverrideWindow: Window;\n  private suppressWarnings: boolean;\n\n  constructor(\n    options: IWindowPostMessageProxyOptions = {\n      processTrackingProperties: {\n        addTrackingProperties: WindowPostMessageProxy.defaultAddTrackingProperties,\n        getTrackingProperties: WindowPostMessageProxy.defaultGetTrackingProperties\n      },\n      isErrorMessage: WindowPostMessageProxy.defaultIsErrorMessage,\n      extractErrorMessage: WindowPostMessageProxy.defaultExtractErrorMessage,\n      receiveWindow: window,\n      name: WindowPostMessageProxy.createRandomString()\n    }) {\n\n    // save options with defaults\n    this.addTrackingProperties = (options.processTrackingProperties && options.processTrackingProperties.addTrackingProperties) || WindowPostMessageProxy.defaultAddTrackingProperties;\n    this.getTrackingProperties = (options.processTrackingProperties && options.processTrackingProperties.getTrackingProperties) || WindowPostMessageProxy.defaultGetTrackingProperties;\n    this.isErrorMessage = options.isErrorMessage || WindowPostMessageProxy.defaultIsErrorMessage;\n    this.extractErrorMessage = options.extractErrorMessage || WindowPostMessageProxy.defaultExtractErrorMessage;\n    this.receiveWindow = options.receiveWindow || window;\n    this.name = options.name || WindowPostMessageProxy.createRandomString();\n    this.target = options.target;\n    this.logMessages = options.logMessages || false;\n    this.eventSourceOverrideWindow = options.eventSourceOverrideWindow;\n    this.suppressWarnings = options.suppressWarnings || false;\n\n    if (this.logMessages) {\n      console.log(`new WindowPostMessageProxy created with name: ${this.name} receiving on window: ${this.receiveWindow.document.title}`);\n    }\n\n    // Initialize\n    this.handlers = [];\n    this.windowMessageHandler = (event: MessageEvent) => this.onMessageReceived(event);\n    this.start();\n  }\n\n  /**\n   * Adds handler.\n   * If the first handler whose test method returns true will handle the message and provide a response. \n   */\n  addHandler(handler: IMessageHandler) {\n    this.handlers.push(handler);\n  }\n  /**\n   * Removes handler.\n   * The reference must match the original object that was provided when adding the handler.\n   */\n  removeHandler(handler: IMessageHandler) {\n    const handlerIndex = this.handlers.indexOf(handler);\n    if (handlerIndex === -1) {\n      throw new Error(`You attempted to remove a handler but no matching handler was found.`);\n    }\n\n    this.handlers.splice(handlerIndex, 1);\n  }\n\n  /**\n   * Start listening to message events.\n   */\n  start() {\n    this.receiveWindow.addEventListener('message', this.windowMessageHandler);\n  }\n\n  /**\n   * Stops listening to message events.\n   */\n  stop() {\n    this.receiveWindow.removeEventListener('message', this.windowMessageHandler);\n  }\n\n  /**\n   * Post message to target window with tracking properties added and save deferred object referenced by tracking id.\n   */\n  postMessage<T>(targetWindow: Window, message: any): Promise<T> {\n    // Add tracking properties to indicate message came from this proxy\n    const trackingProperties: ITrackingProperties = {\n      id: WindowPostMessageProxy.createRandomString(),\n      source: this.name,\n      target: this.target\n    };\n    this.addTrackingProperties(message, trackingProperties);\n\n    if (this.logMessages) {\n      console.warn(`Proxy(${this.name}): Sending:`, JSON.stringify(message, null, '  '));\n    }\n\n    targetWindow.postMessage(message, \"*\");\n    const deferred = WindowPostMessageProxy.createDeferred();\n    this.pendingRequestPromises[trackingProperties.id] = deferred;\n\n    return deferred.promise;\n  }\n\n  /**\n   * Send response message to target window.\n   * Response messages re-use tracking properties from a previous request message.\n   */\n  private sendResponse(targetWindow: Window, message: any, trackingProperties: ITrackingProperties): void {\n    this.addTrackingProperties(message, trackingProperties);\n\n    if (this.logMessages) {\n      console.warn(`Proxy(${this.name}): Responding:`, JSON.stringify(message, null, '  '));\n    }\n\n    targetWindow.postMessage(message, \"*\");\n  }\n\n  /**\n   * Message handler.\n   */\n  private onMessageReceived(event: MessageEvent) {\n    let sendingWindow = this.eventSourceOverrideWindow || event.source;\n    let message: any = event.data;\n\n    if (typeof message !== \"object\") {\n      if (!this.suppressWarnings) {\n        console.warn(`Proxy(${this.name}): Received message that was not an object. Discarding message`);\n      }\n      return;\n    }\n\n    let trackingProperties: ITrackingProperties;\n    try {\n      trackingProperties = this.getTrackingProperties(message);\n\n      if (trackingProperties && trackingProperties.target != null) {\n        if (trackingProperties.target !== this.name) {\n          // skips messages which are not for me\n          return;\n        }\n      }\n\n      if (this.logMessages) {\n        console.warn(`Proxy(${this.name}): Receiving:`, JSON.stringify(event.data, null, '  '));\n      }\n    }\n    catch (e) {\n      if (!this.suppressWarnings) {\n        console.warn(`Proxy(${this.name}): Error occurred when attempting to get tracking properties from incoming message:`, JSON.stringify(message, null, '  '), \"Error: \", e);\n      }\n    }\n\n    let deferred: IDeferred;\n    if (trackingProperties) {\n      deferred = this.pendingRequestPromises[trackingProperties.id];\n    }\n\n    // If message does not have a known ID, treat it as a request\n    // Otherwise, treat message as response\n    if (!deferred) {\n      const handled = this.handlers.some(handler => {\n        let canMessageBeHandled = false;\n        try {\n          canMessageBeHandled = handler.test(message);\n        }\n        catch (e) {\n          if (!this.suppressWarnings) {\n            console.warn(`Proxy(${this.name}): Error occurred when handler was testing incoming message:`, JSON.stringify(message, null, '  '), \"Error: \", e);\n          }\n        }\n\n        if (canMessageBeHandled) {\n          let responseMessagePromise: Promise<any>;\n\n          try {\n            responseMessagePromise = Promise.resolve(handler.handle(message));\n          }\n          catch (e) {\n            if (!this.suppressWarnings) {\n              console.warn(`Proxy(${this.name}): Error occurred when handler was processing incoming message:`, JSON.stringify(message, null, '  '), \"Error: \", e);\n            }\n            responseMessagePromise = Promise.resolve();\n          }\n\n          responseMessagePromise\n            .then(responseMessage => {\n              if (!responseMessage) {\n                const warningMessage = `Handler for message: ${JSON.stringify(message, null, '  ')} did not return a response message. The default response message will be returned instead.`;\n                if (!this.suppressWarnings) {\n                  console.warn(`Proxy(${this.name}): ${warningMessage}`);\n                }\n                responseMessage = {\n                  warning: warningMessage\n                };\n              }\n\n              trackingProperties.target = trackingProperties.source;\n              trackingProperties.source = this.name;\n              this.sendResponse(sendingWindow as Window, responseMessage, trackingProperties);\n            });\n\n          return true;\n        }\n      });\n\n      /**\n       * TODO: Consider returning an error message if nothing handled the message.\n       * In the case of the Report receiving messages all of them should be handled,\n       * however, in the case of the SDK receiving messages it's likely it won't register handlers\n       * for all events. Perhaps make this an option at construction time.\n       */\n      if (!handled && !this.suppressWarnings) {\n        console.warn(`Proxy(${this.name}) did not handle message. Handlers: ${this.handlers.length}  Message: ${JSON.stringify(message, null, '')}.`);\n        // this.sendResponse({ notHandled: true }, trackingProperties);\n      }\n    }\n    else {\n      /**\n       * If error message reject promise,\n       * Otherwise, resolve promise\n       */\n      let isErrorMessage = true;\n      try {\n        isErrorMessage = this.isErrorMessage(message);\n      }\n      catch (e) {\n        console.warn(`Proxy(${this.name}) Error occurred when trying to determine if message is consider an error response. Message: `, JSON.stringify(message, null, ''), 'Error: ', e);\n      }\n\n      if (isErrorMessage) {\n        deferred.reject(this.extractErrorMessage(message));\n      }\n      else {\n        deferred.resolve(message);\n      }\n\n      // TODO: Move to .finally clause up where promise is created for better maitenance like original proxy code.\n      delete this.pendingRequestPromises[trackingProperties.id];\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/windowPostMessageProxy.ts"],"sourceRoot":""}